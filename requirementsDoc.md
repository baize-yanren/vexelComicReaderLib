# 需求文档

## 1. 项目概述
本项目是一个基于本地文件管理系统的漫画阅读软件，目标是为用户提供一个方便、快捷、安全的漫画管理阅读平台。用户可以通过该软件浏览、管理和组织自己的本地漫画库。

## 2. 功能需求
### 2.1 核心功能
#### 2.1.1 漫画库管理
- 库添加与删除
    - 添加库时同时对库进行初始化
    - 删除库时仅删除库目录索引
- 库的初始化
    - 初始化库的#record.json文件
        - 扫描库，将可用的漫画文件索引到#record.json文件中
    - 初始化库的#cover文件夹
        - 扫描库，将可用的漫画文件的封面图片复制到#cover文件夹中，并重命名为漫画编号
- 库信息修改
    - 库名称修改
- 添加漫画
    - 仅支持漫画压缩包（CBZ、CBR、RAR、ZIP）
    - 添加后将目标文件复制到选定的库中
#### 2.1.2 图像浏览
- 图片加载与渲染
- 缩放与旋转
- 翻页控制
#### 2.1.3 标签索引
- 支持对漫画文件进行标签分类
- 支持对漫画文件进行标签搜索
#### 2.1.4 设置与配置
- 界面主题设置
- 阅读偏好配置
- 快捷键设置
### 2.2 辅助功能
- 收藏功能
- 阅读历史记录
- 多语言支持

## 3. 非功能需求
### 3.1 性能要求
- 图像加载时间：单张图片加载不超过0.5秒
- 库扫描速度：1000个文件以内的目录扫描时间不超过3秒
- 内存占用：正常浏览状态下内存占用不超过200MB
- 启动时间：应用程序启动时间不超过5秒

### 3.2 兼容性要求
- 操作系统：支持Windows 10/11
- Python版本：兼容Python 3.8至3.11版本
- 图像格式：支持JPG、PNG、WebP、GIF、PDF等常见漫画格式
- 漫画格式：支持CBZ、CBR、RAR、ZIP等压缩文件
- 分辨率：支持最高4K分辨率图像显示

### 3.3 安全性要求
- 文件操作安全：仅对指定漫画目录进行读写操作
- 数据保护：用户设置和阅读记录加密存储
- 权限控制：不获取系统敏感权限，遵循最小权限原则
- 防崩溃机制：异常图像文件处理不导致程序崩溃

### 3.4 可用性要求
- 界面响应：所有用户操作反馈时间不超过0.3秒
- 错误处理：提供清晰的错误提示和恢复建议
- 无障碍支持：支持键盘导航和屏幕阅读器
- 学习成本：新用户可在5分钟内掌握基本操作

## 4. 用户故事
### 4.1 普通用户
- 作为漫画爱好者，我希望能够添加本地漫画文件夹，以便集中管理我的收藏
- 作为用户，我希望能够按名称、更新日期或阅读进度对漫画进行排序，以便快速找到想看的内容
- 作为用户，我希望支持多种浏览模式（单页、双页、滚动），以便根据漫画类型选择最佳阅读体验

### 4.2 高级用户
- 作为高级用户，我希望能够自定义快捷键，以便提高操作效率
- 作为开发者，我希望有清晰的模块接口，以便扩展新功能
- 作为多语言用户，我希望软件支持中英文切换，以便更好地理解界面内容

## 5. 系统架构
### 5.1 模块划分
- **核心层**
  - 库管理模块（library_manager.py）：负责漫画库的增删改查和扫描
  - 图像处理模块（picture_lib.py）：负责图像加载、渲染和转换
  - 配置管理模块（settings_dialog.py）：处理用户设置和偏好

- **界面层**
  - 主界面模块：提供库浏览和管理界面
  - 阅读器模块（picture_browser.py）：提供漫画阅读功能
  - 设置界面模块：提供配置项编辑界面

- **工具层**
  - 文件操作工具（lib_func.py）：提供文件系统相关操作
  - 国际化工具：提供多语言支持
  - 缓存管理工具：优化图像加载性能

### 5.2 技术选型
- GUI框架：PyQt6
- 图像处理：Pillow、OpenCV
- 数据存储：JSON文件（record.json、settings.json）
- 打包工具：PyInstaller

## 6. 接口说明
### 6.1 内部模块接口
#### 6.1.1 库管理接口
```python
# 库管理模块主要接口
def add_library(path: str) -> bool
# 添加漫画库，返回是否成功
def remove_library(library_id: str) -> bool
# 删除漫画库，返回是否成功
def scan_library(library_id: str) -> List[dict]
# 扫描库内容，返回漫画信息列表
```

#### 6.1.2 图像浏览接口
```python
# 图像浏览模块主要接口
def load_image(path: str) -> Image
# 加载图像文件
def render_image(image: Image, zoom: float) -> QPixmap
# 渲染图像到界面
def navigate_page(direction: str) -> None
# 翻页控制（上一页/下一页）
```

### 6.2 外部依赖接口
- 文件系统接口：os.path, pathlib
- 图像解码接口：Pillow.Image.open
- GUI渲染接口：PyQt6.QtGui

## 7. 数据需求
### 7.1 数据实体
#### 7.1.1 漫画库信息
```json
{
  "id": "unique_library_id",
  "name": "My Comic Library",
  "path": "C:/Comics/",
  "last_scan": "2023-11-01T12:00:00Z",
  "comics_count": 42
}
```

#### 7.1.2 漫画信息（record.json）
```json
{
  "comic_id": "comic_001",
  "title": "Example Comic",
  "author": "Unknown",
  "cover_path": "#cover/comic_001.jpg",
  "file_path": "example_comic.cbz",
  "page_count": 120,
  "last_read_page": 45,
  "tags": ["action", "adventure"]
}
```

### 7.2 数据存储
- 配置数据：settings.json（用户偏好设置）
- 库索引数据：record.json（每个库目录下）
- 封面缓存：#cover目录（每个库目录下）
- 用户数据：阅读历史、收藏列表（JSON格式）

## 8. 验收标准
### 8.1 功能验收
| 功能点 | 验收标准 | 测试方法 |
|--------|----------|----------|
| 库添加 | 成功添加本地目录并生成索引 | 手动添加测试目录验证 |
| 图像浏览 | 支持缩放（50%-200%）和旋转（0°/90°/180°/270°） | 操作界面控件验证 |
| 设置保存 | 修改的设置重启后仍有效 | 修改设置后重启应用验证 |

### 8.2 性能验收
- 冷启动时间≤5秒（无缓存情况下）
- 100张图片的漫画加载时间≤3秒
- 连续翻页无明显卡顿（帧率≥30fps）
- 内存占用峰值≤300MB（4K图像情况下）

### 8.3 兼容性验收
- 支持至少80%的常见漫画文件格式
- 适配1080p、2K、4K三种分辨率显示器

## 9. 项目计划
### 9.1 开发阶段
| 阶段 | 预计时间 | 主要任务 |
|------|------|----------|
| 需求分析 | 1周 | 完善需求文档，确定技术方案 |
| 核心开发 | 4周 | 实现库管理和基础阅读功能 |
| 界面开发 | 2周 | 设计并实现用户界面 |
| 测试优化 | 2周 | 功能测试和性能优化 |
| 打包发布 | 1周 | 制作安装包和发布文档 |

### 9.2 里程碑
- M1：完成库管理模块，支持添加/删除/扫描库
- M2：完成基础阅读功能，支持图片浏览和基本操作
- M3：完成所有功能开发，进入测试阶段
- M4：发布v1.0正式版

## 10. 附录
### 10.1 术语表
| 术语 | 定义 |
|------|------|
| 漫画库 | 包含一个或多个漫画的本地文件夹 |
| 库索引 | 记录漫画信息的JSON文件（record.json） |
| 封面缓存 | 存储漫画封面缩略图的#cover目录 |

### 10.2 参考资料
- [PyQt6官方文档](https://doc.qt.io/qtforpython-6/)
- [Pillow图像处理库](https://pillow.readthedocs.io/)
- [漫画文件格式规范](https://en.wikipedia.org/wiki/Comic_book_archive_file)